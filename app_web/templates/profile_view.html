{% load static %}


<style>
    .container {
        max-width: 1100px;
        margin: 32px auto;
        padding: 20px;
        display: flex;
        gap: 18px;
    }


    .content {
        flex: 1;
    }


    .tabsContainer {
        height: 50px;
        border-radius: 0.5rem;
        width: 100%;
        display: flex;
        align-items: center;
        gap: 12px;
    }


    .custm-tab {
        height: min-content;
        border: 0.9px solid lightgray;
        border-radius: 0.5rem;
        padding: 0.3rem 0.5rem;
        cursor: pointer;
        width: 107px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 500;
    }

    .activeTab {
        background-color: var(--light-primary-color);
        font-weight: 700;
    }



    .section-title {
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 28px 0 14px 0;
        font-weight: 600;
        font-size: 17px;
        color: var(--primary-color);
    }

    .section-title .icon-box {
        width: 34px;
        height: 34px;
        background: var(--primary-color);
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .section-title .icon-box i {
        color: white;
        font-size: 16px;
    }


    @media (max-width:980px) {
        .container {
            padding: 14px
        }


    }

    @media (max-width:620px) {
        .tabsContainer {
            width: 100%
        }
    }

    .table,
    .table td,
    .table th {
        border: none !important;
    }

    .table tbody tr {
        border: none !important;
    }

    .table-responsive {
        border: none !important;
    }

    /* Vertical timeline connector for section icons */
    .section-wrapper {
        position: relative;
    }

    .section-wrapper::before {
        content: "";
        position: absolute;
        left: 17px;
        /* PERFECT center of your 34px icon-box */
        top: 48px;
        /* starts just below the first icon */
        bottom: 0;
        /* connects all sections */
        width: 2px;
        background: #c4d1e8;
        /* your light blue line */
    }



    .section-title .icon-box {
        position: relative;
        z-index: 2;
    }
    .personal-details-table td:first-child {
    padding-right: 4px;   /* reduce space before colon */
    }

    .personal-details-table td:last-child {
        padding-left: 4px;    /* reduce space after colon */
    }

    .strength-box {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: 4px solid #4caf50;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #4caf50;
    font-size: 18px;
    font-weight: 700;

    position: relative;
    cursor: default;
    }

    /* .strength-box::before {
        content: "Profile Strength";
        position: absolute;
        right: 110%;           
        top: 50%;
        transform: translateY(-50%);
        background: #333;
        color: #fff;
        padding: 5px 10px;
        font-size: 12px;
        font-weight: 500;
        border-radius: 4px;
        white-space: nowrap;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease;
        z-index: 10;
    } */
    .strength-box::before {
        /* Change 'content' to pull from the 'data-tip' attribute */
        content: attr(data-tip); 
        position: absolute;
        right: 110%;           
        top: 50%;
        transform: translateY(-50%);
        background: #333;
        color: #fff;
        padding: 8px 12px; /* Increased padding for better look */
        font-size: 19px;
        font-weight: 500;
        border-radius: 4px;
        /* This allows the \a line breaks to work */
        white-space: pre; 
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease;
        z-index: 10;
        text-align: left; /* Align scores to the left */
        line-height: 1.5;
    }

    .strength-box::after {
        content: "";
        position: absolute;
        right: 100%;
        top: 50%;
        transform: translateY(-50%);
        border-width: 6px;
        border-style: solid;
        border-color: transparent transparent transparent #333;
        opacity: 0;
        transition: opacity 0.2s ease;
    }

    .strength-box:hover::before,
    .strength-box:hover::after {
        opacity: 1;
    }

   .wrap-text {
    white-space: normal !important;
    word-break: break-word;
    overflow-wrap: break-word;
    line-height: 1.6;
    }

</style>
<nav aria-label="breadcrumb">
  <ol class="breadcrumb breadcrumb-custom-icon">
    <li class="breadcrumb-item">
      <a href="/profiles">Profiles</a>
      <i class="breadcrumb-icon icon-base bx bx-chevron-right align-middle"></i>
    </li>
    <li class="breadcrumb-item active">
      Profile View
    </li>
  </ol>
</nav>

<div class="credits-container" style="padding-right: 100px;gap: 12px;">
    {% if profile_details.docparserid %}
    <button class="btn btn-primary" onclick="confirmPrefill('{{profile_details.id}}','{{profile_details.docparserid}}')"
        type="button" data-bs-toggle="tooltip" data-bs-placement="top" title="Autofill Details">
        <i class="fas fa-paste"></i>
    </button>
    {% endif %}
    <button class="btn btn-primary" onclick="window.location.href='/viewresume/{{profile_details.id}}'" type="button"
        data-bs-toggle="tooltip" data-bs-placement="top" title="View Resume">
        <i class="fas fa-file-alt"></i>
    </button>
    <button class="btn btn-primary" type="button" onclick="downloadResume('{{ profile_details.id }}')"
        data-bs-toggle="tooltip" data-bs-placement="top" title="Download Resume">
        <i class="fas fa-download"></i>
    </button>
</div>
<div class="container" style="
    padding-top: 0px;
    margin-top: 0px;
">

    <main class="content">

        <div class="card">
            <div class="card-title-table" style="padding-right: 50px;">
                <h4 class="card-header">Profile</h4>
                <!-- <div class="strength-box" id="profileStrengthBox" 
                    data-tip="Education: {{ profile_details.educationscore }}&#10;Experience: {{ profile_details.experiencescore }}&#10;Skills: {{ profile_details.skillsscore }}&#10;Projects: {{ profile_details.projectsscore }}&#10;Certificates: {{ profile_details.certificatesscore }}&#10;Awards: {{ profile_details.awardsscore }} ">
                    
                    <span id="profileStrengthValue">
                        {{ profile_details.strength  }}%
                    </span>
                </div> -->

                

            </div>
            <div class="card-body">

                <div class="tabsContainer">
                    <div style="display: flex; gap: 12px; flex-grow: 1;">
                        <!-- <span id="active" class="custm-tab p-clr activeTab shadow"
                            onclick="tabSwitch(this.id)">Profile</span> -->
                        
                        <span id="active" class="custm-tab p-clr activeTab shadow" onclick="tabSwitch(this.id)" style="display: flex; align-items: center; cursor: pointer;">
                            Profile
                            <span id="editIcon" 
                                style="margin-left: 8px; font-size: 1rem;" 
                                data-bs-toggle="tooltip" 
                                data-bs-placement="top" 
                                title="Edit Profile"
                                onclick="event.stopPropagation(); window.location.href='/update-profile-data/{{profile_details.id}}'">
                                <i class="fas fa-edit"></i>
                            </span>
                        </span>

                        <span id="Inactive" class="custm-tab p-clr" onclick="tabSwitch(this.id)">Activity</span>

                        <div class="strengthRow" id="profileStrengthBox"
                            data-tip="Education: {{ profile_details.educationscore }}&#10;Experience: {{ profile_details.experiencescore }}&#10;Skills: {{ profile_details.skillsscore }}&#10;Projects: {{ profile_details.projectsscore }}&#10;Certificates: {{ profile_details.certificatesscore }}&#10;Awards: {{ profile_details.awardsscore }} ">

                            <label class="p-clr"><b>Strength</b></label>
                            <div class="bar">
                                <div class="fill" id="fill"></div>
                            </div>

                            <span class="pct" id="profileStrengthValue">{{ profile_details.strength  }}</span>
                        </div>

                    </div>

                    <!-- <div style="display:flex;gap:12px;">
                        {% if profile_details.docparserid %}
                        <button class="btn btn-primary" onclick="confirmPrefill('{{profile_details.id}}','{{profile_details.docparserid}}')"
                            type="button" data-bs-toggle="tooltip" data-bs-placement="top" title="Autofill Details">
                            <i class="fas fa-paste"></i>
                        </button>
                        {% endif %}
                        <button class="btn btn-primary" onclick="window.location.href='/viewresume/{{profile_details.id}}'" type="button"
                            data-bs-toggle="tooltip" data-bs-placement="top" title="View Resume">
                            <i class="fas fa-file-alt"></i>
                        </button>
                        <button class="btn btn-primary" type="button" onclick="downloadResume('{{ profile_details.id }}')"
                            data-bs-toggle="tooltip" data-bs-placement="top" title="Download Resume">
                            <i class="fas fa-download"></i>
                        </button>
                    </div> -->
                </div>
                <div class="section-wrapper">

                    <div class="section-title" style="display:flex; align-items:center;">
                        <div class="icon-box">
                            <i class="fas fa-user"></i>
                        </div>

                        <span>Personal Details</span>
                        <!-- <div style="text-align: right;font-size: 1.3rem;cursor: pointer;" data-bs-toggle="tooltip"
                            id="editIcon" data-bs-offset="0,4" data-bs-placement="top" data-bs-html="true" title=""
                            data-bs-original-title="<span>Edit Profile</span>">
                            <i class="fas fa-edit p-clr" onclick="window.location.href='/update-profile-data/{{profile_details.id}}'"></i>
                        </div> -->
                    </div>

                    <div class="table-responsive text-nowrap" style="padding-left: 25px;">
                        <table class="table table-bordered personal-details-table">
                            <tbody>
                                <tr>
                                    <td style="width:1%;">  Title</td>
                                    <td>:&ensp;{{profile_details.title}}</td>
                                </tr>
                                <tr>
                                    <td>  First Name </td>
                                    <td>:&ensp;{{profile_details.firstname}}</td>
                                </tr>
                                {% if profile_details.middlename %}
                                <tr>
                                    <td>  Middle  Name </td>
                                    <td>:&ensp;{{profile_details.middlename}}</td>
                                </tr>
                                {% endif %}
                                <tr>
                                    <td>  Last Name </td>
                                    <td>:&ensp;{{profile_details.lastname}}</td>
                                </tr>

                                <tr>
                                    <td>  Email </td>
                                    <td>:&ensp;{{profile_details.email}}</td>
                                </tr>
                                <tr>
                                    <td>  Mobile </td>
                                    <td>:&ensp;{{profile_details.mobile}}</td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                    <div class="section-title">
                        <div class="icon-box">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        Address
                    </div>

                    <div class="table-responsive text-nowrap" style="padding-left: 25px;">
                        <table class="table table-bordered personal-details-table">
                            <tbody>

                                {% for addr in profile_details.address %}
                                <tr>
                                    <td style="width: 1%;">Address {{ forloop.counter }}</td>
                                    <td>
                                        :&ensp;

                                        {% if addr.addline1 %}
                                        {{ addr.addline1 }}
                                        {% endif %}

                                        {% if addr.addline2 %}
                                        {{ addr.addline2 }}
                                        {% endif %}

                                        {% if addr.city %}
                                        , {{ addr.city }}
                                        {% endif %}

                                        {% if addr.state %}
                                        , {{ addr.state }}
                                        {% endif %}

                                        {% if addr.country %}
                                        , {{ addr.country }}
                                        {% endif %}

                                        {% if addr.zipcode %}
                                        - {{ addr.zipcode }}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}

                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">
                        <div class="icon-box">
                            <i class="fas fa-graduation-cap"></i>
                        </div>Education
                    </div>

                    <div class="table-responsive text-nowrap" style="padding-left: 25px;">
                        <table class="table table-bordered">
                            <tbody>
                                {% for edu in profile_details.education %}

                                <tr>
                                    <td>
                                        {{ edu.course }} from {{ edu.institute }}
                                        {{ edu.yearfrom }} - {{ edu.yearto }}
                                        — Grade - {{ edu.grade }}
                                    </td>
                                </tr>

                                {% endfor %}


                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">
                        <div class="icon-box">
                            <i class="fas fa-briefcase"></i>
                        </div>Experience
                    </div>
                    <div class="table-responsive text-nowrap" style="padding-left: 25px;">
                        <table class="table table-bordered">
                            <tbody>
                                {% for exp in profile_details.experience %}

                                <tr>
                                    <td>
                                        {{ exp.jobtitle }} at {{ exp.company }}
                                        {{ exp.yearfrom }} - {{ exp.yearto }}
                                    </td>
                                </tr>

                                {% endfor %}


                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">
                        <div class="icon-box">
                            <i class="fas fa-tools"></i>
                        </div>Skills
                    </div>
                    <div class="table-responsive text-nowrap" style="padding-left: 25px;">
                        <table class="table table-bordered">
                            <tbody>
                                <tr>
                                    <td class="wrap-text">
                                        {{ profile_details.skills_display }}

                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">
                        <div class="icon-box">
                            <i class="fas fa-folder-open"></i>
                        </div>Projects
                    </div>
                    <div class="table-responsive text-nowrap" style="padding-left: 25px;">
                        <table class="table table-bordered">
                            <tbody>
                                {% for p in profile_details.projects %}
                                <tr>
                                    <td class="wrap-text">

                                        {{ p.projectname }}
                                        — {{ p.clientname }}
                                        — {{ p.roleplayed }}
                                        — Skills: {{ p.skillsused }}
                                        — ({{ p.yearsfrom }} to {{ p.yearsto }})
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">
                        <div class="icon-box">
                            <i class="fas fa-certificate"></i>
                        </div>Certificate
                    </div>
                    <div class="table-responsive text-nowrap" style="padding-left: 25px;">
                        <table class="table table-bordered">
                            <tbody>
                                {% for c in profile_details.certificates %}
                                <tr>
                                    <td>
                                        {{ c.certname }}
                                        — {{ c.year }}
                                    </td>
                                </tr>
                             
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <div class="section-title">
                        <div class="icon-box">
                            <i class="fas fa-award"></i>
                        </div>Awards
                    </div>
                    <div class="table-responsive text-nowrap" style="padding-left: 25px;">
                        <table class="table table-bordered">
                            <tbody>
                                {% for a in profile_details.awards %}
                                <tr>
                                    <td>
                                        {{ a.awardname }}
                                        — {{ a.year }}
                                    </td>
                                </tr>
                           
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                </div>

            </div>
    </main>
</div>


<style>

    /* Container */
    .strengthRow{
      width: min(520px, 92%);
      display:flex;
      align-items:center;
      gap: 14px;
      position: relative;
      margin-left: auto;
    }

    /* Bar */
    .bar{
      flex:1;
      height: 10px;
      background:#e5eaf5;
      border-radius: 999px;
      overflow:hidden;
    }

    .fill{
      height:100%;
      width: 0%;
      border-radius: 999px;
      transition: width 600ms ease;
    }

    /* Strength Colors */
    .fill.green{ background:#22c55e; }
    .fill.orange{ background:#f59e0b; }
    .fill.red{ background:#ef4444; }

    /* Percentage */
    .pct{
      font-weight: 800;
      font-size: 15px;
      color:var(--primary-color);
      min-width: 42px;
      text-align:right;
    }

    /* Tooltip */
    .strengthRow::after{
      content: attr(data-tip);
      position: absolute;
      left: 0;
      top: calc(100% + 12px);
      width: max-content;
      max-width: 340px;

      background: #0f172a;
      color: #fff;
      font-size: 12px;
      font-weight: 600;
      line-height: 1.4;

      padding: 10px 12px;
      border-radius: 12px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.18);

      opacity: 0;
      pointer-events: none;
      transform: translateY(-6px);
      transition: 0.18s ease;
      white-space: pre-line;
      z-index: 99;
    }

    .strengthRow:hover::after{
      opacity: 1;
      transform: translateY(0px);
    }
  </style>
 <script>
    // Read % from HTML
    const strengthText = document.getElementById("profileStrengthValue").innerText.trim();
    const strength = parseInt(strengthText.replace("%",""), 10) || 0;

    // Your logic
    var strengthClass = "red";
    if (strength >= 70) strengthClass = "green";
    else if (strength >= 40) strengthClass = "orange";

    // Apply bar
    const fill = document.getElementById("fill");
    fill.style.width = strength + "%";
    fill.classList.add(strengthClass);
</script>

<script>
    const pid = "{{ profile_details.id }}";
</script>
<script src="{% static 'js/profile_view.js' %}"></script>